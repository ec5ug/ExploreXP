
{% extends 'mapBase.html' %}
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Categories</title>
</head>
<body>


{% block content %}
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCAc74O5Z2PVfxjPpuoqktAT5wGuiIs-qQ&callback=initMap">
    </script>

  <style>
    body {
      font-family: 'Times New Roman', serif;
      background-color: #f8f8f8;
      margin: 0;
      padding:0;
      text-align: center;
    }

    h1 {
      color: #333;
    }

            #map-container {
            height: 80vh; /* 80% of the viewport height */
            width: 50vw; /* 50% of the viewport width */
            display: inline-block;
            vertical-align: top; /* Align to the top of the map */
        }

        #category-list {
            display: inline-block;
            vertical-align: top; /* Align to the top of the map */
            padding: 20px;
            width: 40vw; /* Adjust the width of the list as needed */
            overflow-y: auto; /* Add scroll if the list exceeds the height */
            font-weight: bold;
        }

        .category-link {
        display: inline-block; /* Display buttons inline */
        margin-right: 10px; /* Add margin to separate buttons */
        padding: 10px 20px;
        background-color: #f46e1e;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
        transition: background-color 0.3s;
        }

        .category-link:hover {
            background-color: #f46e1e;
        }
 </style>

<script>
    var placeTypes = [
    "airport", "amusement_park", "aquarium", "art_gallery",
     "bakery", "bank", "bar", "beauty_salon", "bicycle_store",
    "book_store", "bowling_alley", "bus_station", "cafe", "campground",
     "church", "city_hall", "clothing_store", "convenience_store",
    "courthouse",  "department_store",
     "gym",
     "hindu_temple",
     "library",
     "mosque",
    "movie_theater",  "museum", "night_club",
    "park", "parking", "pet_store",
     "primary_school",
    "restaurant", "rv_park", "school", "secondary_school",
     "shopping_mall", "spa", "stadium", "store",
     "supermarket", "synagogue", "tourist_attraction",
    "train_station", "transit_station", "university",
    "zoo"
];

</script>

<h1>Welcome, {{user.username}}!</h1>

  <button class="filterButton category-link" data-location-type="university">Study Spaces</button>
  <button class="filterButton category-link" data-location-type="cafe">Caf√©s</button>
  <button class="filterButton category-link" data-location-type="library">Libraries</button>
  <button class="filterButton category-link" data-location-type="tourist_attraction">Attractions</button>
  <button class="filterButton category-link" data-location-type="museum">Museums</button>
  <button class="filterButton category-link" data-location-type="gym">Gyms</button>
  <button class="filterButton category-link" data-location-type="park">Parks</button>
  <button class="filterButton category-link" data-location-type="shopping_mall">Mall</button>
  <button class="filterButton category-link" data-location-type="restaurant">Restaurants</button>
  <button class="filterButton category-link" data-location-type="bar">Night Life</button>

  <form id="categoryForm" method="post">
        {% csrf_token %}
        <label for="id_type">Or Select a Category:</label>
        <select id="id_type" name="type" required>
            <option value="" disabled selected>Select a Category</option>
        </select>
        <button type="button" onclick="submitForm()">Submit Place</button>
  </form>

<script>
function formatCategoryName(category) {
    // Capitalize each word and replace underscores with spaces
    return category.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
}

function capitalizeEachWord(str) {
    return str.replace(/\b\w/g, function (match) {
        return match.toUpperCase();
    });
}
   var select = document.getElementById("id_type");
    placeTypes.forEach(function(type) {
        var option = document.createElement("option");
        option.setAttribute("value", type);
        option.textContent = capitalizeEachWord(type.replace(/_/g, " ")); // Capitalize each word and replace underscores with spaces
        select.appendChild(option);
    });

        function submitForm() {
        var selectedCategory = document.getElementById("id_type").value;;

        var formattedCategory = formatCategoryName(selectedCategory);

        // Update the selected category display
        document.getElementById("selectedCategory").textContent = formattedCategory;

            // Make an AJAX request to the backend to get locations for the selected category
            fetch(`/get_locations/?category=${selectedCategory}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.locations && data.locations.length > 0) {
                        console.log(`Locations for ${selectedCategory}:`, data.locations);
                        initMap(data.locations);  // Initialize the map with fetched data

                        var categoryList = document.getElementById("category-list");
                        categoryList.innerHTML = '';

                        var categoryHeading = document.createElement("h2");
                        categoryHeading.textContent = `${formattedCategory}:`;
                        categoryList.appendChild(categoryHeading);

                        data.locations.forEach(function(place) {
                        var placeItem = document.createElement("p");
                        placeItem.style.fontSize = "30px";
                        placeItem.textContent = place.name; // Adjust this based on your place object
                        categoryList.appendChild(placeItem);
                    });

                    } else {
                        console.error(`No locations data available for ${selectedCategory}.`);
                        document.getElementById("category-list").innerHTML = '<p>There are no locations that belong to this category yet. How about try adding some?</p>';
                    }
                })
                .catch(error => console.error(`Error fetching locations for ${selectedCategory}:`, error));
        }



document.querySelectorAll('.category-link').forEach(function(button) {
    button.addEventListener('click', function() {
        var selectedCategory = this.dataset.locationType;
        var formattedCategory = formatCategoryName(selectedCategory);

        // Update the selected category display
        document.getElementById("selectedCategory").textContent = formattedCategory;

        // Make an AJAX request to the backend to get locations for the selected category
        fetch(`/get_locations/?category=${selectedCategory}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.locations && data.locations.length > 0) {
                    console.log(`Locations for ${selectedCategory}:`, data.locations);
                    initMap(data.locations);  // Initialize the map with fetched data
                } else {
                    console.error(`No locations data available for ${selectedCategory}.`);
                }
            })
            .catch(error => console.error(`Error fetching locations for ${selectedCategory}:`, error));
    });
});

var markers = [];

function initMap(locations) {
    // Clear existing markers
    markers.forEach(marker => marker.setMap(null));
    markers = [];

    var mapOptions = {
        center: { lat: 38.0336, lng: -78.5080 },
        zoom: 14,
        styles: [
            {
                featureType: 'poi',
                stylers: [
                    {visibility: 'off'}
                ]
            }

        ]
    };

    var map = new google.maps.Map(document.getElementById('map'), mapOptions);

    if (locations && locations.length > 0) {
        locations.forEach(function(location) {
            var marker = new google.maps.Marker({
                position: { lat: parseFloat(location.lat), lng: parseFloat(location.long) },
                map: map,
                title: location.name
            });

            markers.push(marker);

            const infoWindow = new google.maps.InfoWindow({
                content: `<div><strong><center>${location.name}</center></strong>` +
                    `<center><a href="/placePage/?name_slug=${location.name}">View Page</a></center></div>`
            });
            marker.addListener('click', function () {
                infoWindow.open(map, marker);
            });
        });
    } else {
        console.error('No locations data available.');
    }
}

</script>

</script>



    <style>
        #map {
            height: 100%;
            width: 100%;
        }

         </style>

<div class="linkholder">
        <div class="mapholder" id="map-container">
            <div id="map"></div>
        </div>

        <div class="text" id="category-list">
            <h1><center><p id="selectedCategory"> Choose a Category! </p></center></h1>
            <!-- Add content to the category list as needed -->
        </div>
    </div>


<script>
// Attach click event to all elements with the 'category-link' class
document.querySelectorAll('.category-link').forEach(function(button) {
    button.addEventListener('click', function() {
        var selectedCategories = this.dataset.locationType.split(' ');

        selectedCategories.forEach(function(category) {
            fetch(`/get_locations/?category=${category}`)
                .then(response => response.json())
                .then(data => {
                    console.log(`Locations for ${category}:`, data.locations);
                })
                .catch(error => console.error(`Error fetching locations for ${category}:`, error));
        });
    });
});

var markers = [];
</script>


{% endblock %}

</body>

